from django.http import HttpResponse
from openai import OpenAI
from decouple import config

def teste_ia(request):
    try:
        # 1. Configura o cliente da OpenAI com sua chave
        client = OpenAI(api_key=config('OPENAI_API_KEY'))
        
        # 2. Manda uma mensagem de teste
        resposta = client.chat.completions.create(
            model="gpt-4o-mini",  # Modelo r√°pido e barato
            messages=[
                {"role": "system", "content": "Voc√™ √© um assistente m√©dico √∫til."},
                {"role": "user", "content": "Diga: 'Ol√°! O Agente Prescritto est√° conectado e pronto para ajudar.'"}
            ]
        )
        
        # 3. Pega o texto da resposta
        texto_ia = resposta.choices[0].message.content
        
        # 4. Mostra na tela
        return HttpResponse(f"<h1>Sucesso! ü§ñ</h1><p>{texto_ia}</p>")

    except Exception as e:
        # Se der erro (chave errada, sem saldo, etc), mostra aqui
        return HttpResponse(f"<h1>Ops, deu erro:</h1><p>{e}</p>")